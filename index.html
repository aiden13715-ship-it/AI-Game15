<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>NeuroGrid: Neon Futuristic AI Trainer</title>
<style>
  :root{
    --bg0:#040615;
    --bg1:#060a22;
    --panel: rgba(10, 14, 40, .62);
    --panel2: rgba(6, 10, 34, .55);
    --line: rgba(255,255,255,.10);
    --text: rgba(240,245,255,.95);
    --muted: rgba(240,245,255,.72);
    --cyan: #27f3ff;
    --mag:  #b25bff;
    --lime: #76ff9b;
    --amber:#ffd28a;
    --red:  #ff6b8a;
    --radius: 20px;
  }

  *{ box-sizing:border-box; }
  html, body { height:100%; }
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color: var(--text);
    background:
      radial-gradient(900px 480px at 18% 18%, rgba(39,243,255,.14), transparent 60%),
      radial-gradient(900px 480px at 82% 12%, rgba(178,91,255,.12), transparent 60%),
      radial-gradient(900px 520px at 60% 88%, rgba(118,255,155,.08), transparent 60%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    overflow-x:hidden;
  }

  /* Animated aurora shimmer */
  .aurora{
    position: fixed; inset:-60px;
    z-index:-3;
    background:
      radial-gradient(680px 280px at 22% 28%, rgba(39,243,255,.22), transparent 60%),
      radial-gradient(620px 260px at 78% 22%, rgba(178,91,255,.18), transparent 60%),
      radial-gradient(620px 260px at 55% 78%, rgba(118,255,155,.12), transparent 60%);
    filter: blur(16px);
    opacity:.9;
    animation: drift 11s ease-in-out infinite alternate;
  }
  @keyframes drift{
    0%{ transform: translate3d(-14px,-10px,0) scale(1); }
    100%{ transform: translate3d(14px,12px,0) scale(1.03); }
  }

  /* Subtle moving grid overlay */
  .bgGrid{
    position: fixed; inset:0;
    z-index:-2;
    opacity:.22;
    background-image:
      linear-gradient(to right, rgba(255,255,255,.09) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255,255,255,.07) 1px, transparent 1px);
    background-size: 56px 56px;
    mask-image: radial-gradient(circle at 50% 30%, rgba(0,0,0,1), rgba(0,0,0,.0) 65%);
    animation: gridMove 12s linear infinite;
  }
  @keyframes gridMove{
    from{ background-position: 0 0, 0 0; }
    to{ background-position: 0 140px, 140px 0; }
  }

  /* Scanlines */
  .scanlines{
    position: fixed; inset:0;
    z-index:-1;
    pointer-events:none;
    background: repeating-linear-gradient(
      to bottom,
      rgba(0,0,0,.0) 0px,
      rgba(0,0,0,.0) 3px,
      rgba(0,0,0,.12) 4px
    );
    mix-blend-mode: overlay;
    opacity:.40;
  }

  header{
    position: sticky;
    top:0;
    z-index: 5;
    background: rgba(6,10,34,.55);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(255,255,255,.10);
    padding: 18px 16px;
    animation: dropIn .55s ease-out both;
  }
  @keyframes dropIn{
    from{ opacity:0; transform: translateY(-14px); }
    to{ opacity:1; transform: translateY(0); }
  }
  .wrap{ max-width: 1040px; margin: 0 auto; }
  .titleRow{ display:flex; gap: 14px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
  h1{
    margin:0;
    font-size: 20px;
    letter-spacing:.35px;
    text-transform: uppercase;
  }
  .subtitle{
    margin-top:6px;
    color: var(--muted);
    font-size: 13px;
    line-height: 1.35;
  }

  /* Glitch text effect (lightweight) */
  .glitch{
    position: relative;
    display: inline-block;
    text-shadow:
      0 0 14px rgba(39,243,255,.30),
      0 0 18px rgba(178,91,255,.22);
  }
  .glitch::before,
  .glitch::after{
    content: attr(data-text);
    position:absolute;
    left:0; top:0;
    opacity:.45;
    clip-path: inset(0 0 0 0);
    pointer-events:none;
  }
  .glitch::before{
    transform: translate(1px, -1px);
    color: rgba(39,243,255,.95);
    animation: glitchA 2.4s infinite linear alternate-reverse;
  }
  .glitch::after{
    transform: translate(-1px, 1px);
    color: rgba(178,91,255,.95);
    animation: glitchB 2.2s infinite linear alternate-reverse;
  }
  @keyframes glitchA{
    0%{ clip-path: inset(0 0 88% 0); }
    20%{ clip-path: inset(12% 0 60% 0); }
    40%{ clip-path: inset(48% 0 28% 0); }
    60%{ clip-path: inset(72% 0 10% 0); }
    80%{ clip-path: inset(18% 0 68% 0); }
    100%{ clip-path: inset(0 0 90% 0); }
  }
  @keyframes glitchB{
    0%{ clip-path: inset(82% 0 0 0); }
    25%{ clip-path: inset(58% 0 14% 0); }
    50%{ clip-path: inset(28% 0 46% 0); }
    75%{ clip-path: inset(10% 0 74% 0); }
    100%{ clip-path: inset(86% 0 0 0); }
  }

  main{
    max-width: 1040px;
    margin: 0 auto;
    padding: 16px;
    display:grid;
    gap: 14px;
  }
  .grid2{
    display:grid;
    gap: 14px;
    grid-template-columns: 1fr;
  }
  @media (min-width: 900px){
    .grid2{ grid-template-columns: 1.05fr .95fr; }
  }

  .card{
    background: var(--panel);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: var(--radius);
    padding: 16px;
    box-shadow: 0 18px 55px rgba(0,0,0,.38);
    position: relative;
    overflow:hidden;
    animation: cardIn .6s ease-out both;
  }
  .card::before{
    content:"";
    position:absolute; inset:-2px;
    background:
      radial-gradient(420px 140px at 20% 10%, rgba(39,243,255,.18), transparent 60%),
      radial-gradient(420px 140px at 80% 0%, rgba(178,91,255,.14), transparent 60%),
      radial-gradient(520px 140px at 50% 100%, rgba(118,255,155,.10), transparent 60%);
    opacity:.85;
    filter: blur(10px);
    pointer-events:none;
  }
  .card > *{ position: relative; }
  @keyframes cardIn{
    from{ opacity:0; transform: translateY(14px) scale(.985); }
    to{ opacity:1; transform: translateY(0) scale(1); }
  }

  .hud{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom: 10px;
  }
  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 8px 10px;
    border-radius: 999px;
    font-size: 12px;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    box-shadow: 0 0 0 1px rgba(39,243,255,.05) inset;
  }
  .pill strong{ font-weight: 800; letter-spacing:.2px; }

  .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .row > *{ flex:1; min-width: 160px; }

  label{ display:block; font-size:12px; color: var(--muted); margin-bottom: 6px; }

  select, button{
    width:100%;
    border-radius: 14px;
    padding: 12px 12px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(5, 8, 28, .68);
    color: var(--text);
    outline: none;
  }
  select:focus{
    border-color: rgba(39,243,255,.55);
    box-shadow: 0 0 0 3px rgba(39,243,255,.10);
  }

  button{
    cursor:pointer;
    font-weight: 900;
    letter-spacing:.3px;
    text-transform: uppercase;
    background: linear-gradient(135deg, rgba(39,243,255,.55), rgba(178,91,255,.50));
    box-shadow: 0 14px 34px rgba(0,0,0,.35);
    position: relative;
    overflow:hidden;
    transition: transform .12s ease, filter .18s ease;
  }
  button::after{
    content:"";
    position:absolute; inset:-2px;
    background: radial-gradient(220px 60px at var(--x,20%) var(--y,30%), rgba(255,255,255,.40), transparent 62%);
    opacity:0;
    transition: opacity .18s ease;
    pointer-events:none;
  }
  button:hover{ transform: translateY(-1px); filter: brightness(1.08); }
  button:hover::after{ opacity:.60; }
  button:active{ transform: translateY(0) scale(.99); }
  button:disabled{ opacity:.55; cursor:not-allowed; transform:none; box-shadow:none; }

  .arena{
    display:grid;
    place-items:center;
    padding: 8px 0 2px;
  }

  .patternGrid{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    width: min(360px, 100%);
    padding: 14px;
    border-radius: 18px;
    background: rgba(0,0,0,.18);
    border: 1px solid rgba(255,255,255,.10);
    box-shadow: 0 0 0 1px rgba(39,243,255,.07) inset;
    position: relative;
    overflow:hidden;
  }
  .patternGrid::before{
    content:"";
    position:absolute; inset:-2px;
    background: linear-gradient(90deg, transparent, rgba(39,243,255,.08), transparent);
    transform: translateX(-60%);
    animation: sweep 2.4s linear infinite;
    pointer-events:none;
  }
  @keyframes sweep{
    from{ transform: translateX(-70%); }
    to{ transform: translateX(70%); }
  }

  .cell{
    aspect-ratio: 1;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(6,10,34,.70);
    box-shadow:
      0 10px 22px rgba(0,0,0,.25),
      0 0 0 1px rgba(39,243,255,.04) inset;
    transition: transform .16s ease, filter .16s ease;
    position: relative;
    overflow:hidden;
  }
  .cell:hover{
    transform: translateY(-1px) scale(1.01);
    filter: brightness(1.08);
  }

  /* ‚ÄúActive‚Äù neon cell */
  .cell.on{
    background: linear-gradient(135deg, rgba(39,243,255,.70), rgba(178,91,255,.65));
    border-color: rgba(255,255,255,.20);
    box-shadow:
      0 14px 30px rgba(0,0,0,.25),
      0 0 18px rgba(39,243,255,.22),
      0 0 22px rgba(178,91,255,.18);
    animation: pulse 1.25s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ transform: scale(1); }
    50%{ transform: scale(1.03); }
  }

  .cell.on::after{
    content:"";
    position:absolute; inset:-2px;
    background: radial-gradient(120px 80px at 30% 20%, rgba(255,255,255,.35), transparent 60%);
    opacity:.65;
    pointer-events:none;
  }

  .sectionTitle{
    display:flex;
    align-items:baseline;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom: 8px;
  }
  .sectionTitle .big{
    font-size: 16px;
    font-weight: 900;
    letter-spacing:.25px;
    text-transform: uppercase;
  }
  .sectionTitle .small{
    font-size: 12px;
    color: var(--muted);
  }

  .aiLine{
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }
  .aiBadge{
    padding: 10px 12px;
    border-radius: 16px;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    display:flex;
    align-items:center;
    gap:10px;
  }
  .aiDot{
    width:10px; height:10px;
    border-radius:999px;
    background: var(--cyan);
    box-shadow: 0 0 16px rgba(39,243,255,.65);
    animation: blink 1.1s ease-in-out infinite;
  }
  @keyframes blink{
    0%,100%{ opacity:.35; }
    50%{ opacity:1; }
  }
  .aiGuess{
    font-weight: 1000;
    letter-spacing:.5px;
  }

  .meter{
    height: 14px;
    border-radius: 999px;
    background: rgba(0,0,0,.28);
    border: 1px solid rgba(255,255,255,.10);
    overflow:hidden;
    box-shadow: 0 0 0 1px rgba(39,243,255,.06) inset;
  }
  .meterFill{
    height:100%;
    width: 50%;
    background: linear-gradient(90deg, rgba(39,243,255,.75), rgba(178,91,255,.70), rgba(118,255,155,.55));
    filter: saturate(1.2);
    box-shadow: 0 0 18px rgba(39,243,255,.22);
    position: relative;
    transition: width .45s ease;
  }
  .meterFill::after{
    content:"";
    position:absolute; inset:0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,.28), transparent);
    transform: translateX(-60%);
    animation: sheen 1.8s linear infinite;
    opacity:.7;
  }
  @keyframes sheen{
    from{ transform: translateX(-70%); }
    to{ transform: translateX(70%); }
  }

  .log{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 12px;
    line-height: 1.45;
    max-height: 260px;
    overflow:auto;
    padding: 12px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.22);
  }
  .good{ color: var(--lime); }
  .bad{ color: var(--red); }
  .warn{ color: var(--amber); }

  /* Toast */
  .toast{
    position: fixed;
    left: 50%;
    top: 78px;
    transform: translateX(-50%);
    z-index: 50;
    padding: 10px 14px;
    border-radius: 999px;
    background: rgba(6,10,34,.65);
    border: 1px solid rgba(255,255,255,.16);
    backdrop-filter: blur(12px);
    box-shadow: 0 18px 50px rgba(0,0,0,.42);
    font-size: 13px;
    opacity: 0;
    pointer-events:none;
  }
  .toast.show{ animation: toastPop 1.35s ease-out both; }
  @keyframes toastPop{
    0%{ opacity:0; transform: translateX(-50%) translateY(-6px) scale(.985); }
    16%{ opacity:1; transform: translateX(-50%) translateY(0) scale(1); }
    82%{ opacity:1; }
    100%{ opacity:0; transform: translateX(-50%) translateY(-7px) scale(.99); }
  }

  /* Intro overlay (instant attention) */
  .intro{
    position: fixed; inset:0;
    z-index: 80;
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 16px;
    background: rgba(0,0,0,.50);
    backdrop-filter: blur(12px);
  }
  .introCard{
    width: min(940px, 100%);
    border-radius: 24px;
    padding: 16px;
    border: 1px solid rgba(255,255,255,.16);
    background: rgba(6,10,34,.68);
    box-shadow: 0 28px 80px rgba(0,0,0,.55);
    position: relative;
    overflow:hidden;
    animation: introIn .65s ease-out both;
  }
  .introCard::before{
    content:"";
    position:absolute; inset:-2px;
    background:
      radial-gradient(520px 180px at 20% 10%, rgba(39,243,255,.22), transparent 60%),
      radial-gradient(520px 180px at 85% 18%, rgba(178,91,255,.18), transparent 60%),
      radial-gradient(520px 180px at 55% 90%, rgba(118,255,155,.12), transparent 60%);
    filter: blur(10px);
    opacity: .95;
  }
  .introCard > *{ position: relative; }
  @keyframes introIn{
    from{ opacity:0; transform: translateY(18px) scale(.98); }
    to{ opacity:1; transform: translateY(0) scale(1); }
  }
  .introTitle{
    font-size: 22px;
    font-weight: 1000;
    margin: 0 0 6px 0;
    letter-spacing:.5px;
    text-transform: uppercase;
  }
  .introText{
    margin:0;
    color: var(--muted);
    font-size: 13px;
    line-height:1.4;
  }
  .chips{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top: 14px;
  }
  .chip{
    padding: 8px 10px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    font-size: 12px;
  }

  .footer{
    opacity:.82;
    font-size: 12px;
    color: var(--muted);
    padding: 0 16px 22px;
    max-width: 1040px;
    margin: 0 auto;
  }
</style>
</head>

<body>
  <div class="aurora"></div>
  <div class="bgGrid"></div>
  <div class="scanlines"></div>
  <div class="toast" id="toast"></div>

  <!-- Intro overlay -->
  <div class="intro" id="intro">
    <div class="introCard">
      <div class="row" style="align-items:flex-start;">
        <div style="flex: 1.3; min-width: 260px;">
          <div class="introTitle glitch" data-text="NeuroGrid: AI Training Lab">NeuroGrid: AI Training Lab</div>
          <p class="introText">
            You‚Äôre the trainer. The AI tries to label patterns as <b>TARGET</b> or <b>NOT TARGET</b>.
            Give feedback to improve its accuracy. <b>5 rounds</b> √ó <b>5 turns</b>.
          </p>
          <div class="chips">
            <span class="chip">‚ö° Neon Futuristic UI</span>
            <span class="chip">üß† Learning / Feedback Loop</span>
            <span class="chip">üõ°Ô∏è Error Handling</span>
            <span class="chip">üéÆ Browser-only</span>
          </div>
          <div class="row" style="margin-top:14px;">
            <button id="enterBtn" style="max-width: 280px;">Boot System</button>
            <div style="color:var(--muted); font-size:12px; align-self:center;">
              Tip: Press ‚ÄúStart / Restart‚Äù to begin.
            </div>
          </div>
        </div>

        <div style="flex:.7; min-width: 240px;">
          <div class="pill" style="justify-content:center; margin-bottom:10px;">
            <strong>LIVE DIAGNOSTICS</strong> <span style="opacity:.75;">(visuals + log)</span>
          </div>
          <div class="meter" title="Boot progress">
            <div class="meterFill" style="width: 100%;"></div>
          </div>
          <div style="height:10px;"></div>
          <div class="pill"><span class="aiDot"></span> System online ‚Ä¢ Neon mode enabled</div>
        </div>
      </div>
    </div>
  </div>

  <header>
    <div class="wrap">
      <div class="titleRow">
        <div>
          <h1 class="glitch" data-text="NeuroGrid: Train the AI">NeuroGrid: Train the AI</h1>
          <div class="subtitle">Neon futuristic pattern trainer ‚Ä¢ 5 rounds √ó 5 turns ‚Ä¢ Smooth animations ‚Ä¢ Runs in any browser</div>
        </div>
        <div class="hud" id="hud"></div>
      </div>
    </div>
  </header>

  <main class="grid2">
    <section class="card">
      <div class="sectionTitle">
        <div class="big">Pattern Arena</div>
        <div class="small" id="turnInfo">Turn 1/5</div>
      </div>

      <div class="row">
        <div>
          <label for="mode">Difficulty</label>
          <select id="mode">
            <option value="easy">Easy (simple patterns)</option>
            <option value="normal" selected>Normal (mixed patterns)</option>
            <option value="hard">Hard (more noise)</option>
          </select>
        </div>
        <div>
          <label>&nbsp;</label>
          <button id="startBtn">Start / Restart</button>
        </div>
      </div>

      <div style="height:12px;"></div>

      <div class="arena">
        <div class="patternGrid" id="grid"></div>
      </div>

      <div style="height:12px;"></div>

      <div class="aiLine">
        <div class="aiBadge">
          <span class="aiDot"></span>
          <div>
            <div style="font-size:12px; color:var(--muted);">AI CLASSIFICATION</div>
            <div class="aiGuess" id="aiGuess">‚Äî</div>
          </div>
        </div>

        <div style="flex:1; min-width: 220px;">
          <div style="font-size:12px; color:var(--muted); margin-bottom:6px;">AI CONFIDENCE</div>
          <div class="meter"><div class="meterFill" id="confidenceBar" style="width:50%"></div></div>
        </div>
      </div>

      <div style="height:12px;"></div>

      <div class="row">
        <button id="correctBtn">AI was Correct</button>
        <button id="wrongBtn" style="background: linear-gradient(135deg, rgba(255,107,138,.60), rgba(178,91,255,.48));">
          AI was Wrong
        </button>
      </div>

      <div style="margin-top:10px; font-size:12px; color:var(--muted);">
        Error handling: buttons disable after match ends, and the game prevents invalid states.
      </div>
    </section>

    <aside class="card">
      <div class="sectionTitle">
        <div class="big">Training Log</div>
        <div class="small">Copy this for process notes</div>
      </div>

      <div class="log" id="log"></div>

      <div style="height:12px;"></div>

      <div class="row">
        <button id="copyLogBtn">Copy Log</button>
        <button id="clearLogBtn" style="background: linear-gradient(135deg, rgba(39,243,255,.35), rgba(255,255,255,.08));">
          Clear Log
        </button>
      </div>
    </aside>
  </main>

  <div class="footer">
    Shareable link: GitHub Pages / CodePen / Replit ‚Ä¢ No downloads required ‚Ä¢ Works in Chrome/Edge/Firefox.
  </div>

<script>
(() => {
  // ---------- DOM ----------
  const $ = (id) => document.getElementById(id);
  const hudEl = $("hud");
  const gridEl = $("grid");
  const logEl  = $("log");
  const toastEl = $("toast");
  const aiGuessEl = $("aiGuess");
  const confBar = $("confidenceBar");
  const turnInfo = $("turnInfo");

  // Button shimmer tracking
  document.addEventListener("pointermove", (e) => {
    const btn = e.target.closest("button");
    if(!btn) return;
    const r = btn.getBoundingClientRect();
    const x = ((e.clientX - r.left) / r.width) * 100;
    const y = ((e.clientY - r.top) / r.height) * 100;
    btn.style.setProperty("--x", x + "%");
    btn.style.setProperty("--y", y + "%");
  });

  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.remove("show");
    void toastEl.offsetWidth;
    toastEl.classList.add("show");
  }

  function log(msg, cls=""){
    const line = document.createElement("div");
    if(cls) line.className = cls;
    const t = new Date().toLocaleTimeString();
    line.textContent = `[${t}] ${msg}`;
    logEl.appendChild(line);
    logEl.scrollTop = logEl.scrollHeight;
  }

  function setButtonsEnabled(enabled){
    $("correctBtn").disabled = !enabled;
    $("wrongBtn").disabled = !enabled;
  }

  // ---------- Patterns ----------
  // Target patterns: ‚Äúlines‚Äù and ‚Äúdiagonals‚Äù
  const targets = [
    [0,1,2], [3,4,5], [6,7,8],  // rows
    [0,3,6], [1,4,7], [2,5,8],  // cols
    [0,4,8], [2,4,6]            // diagonals
  ];

  function difficultyConfig(mode){
    if(mode === "easy")   return { noiseMax: 0,  learnStep: 7,  penalty: 4 };
    if(mode === "hard")   return { noiseMax: 2,  learnStep: 5,  penalty: 6 };
    return                return { noiseMax: 1,  learnStep: 6,  penalty: 5 };
  }

  // ---------- State ----------
  const state = {
    mode: "normal",
    round: 1,
    turn: 1,
    maxRounds: 5,
    maxTurns: 5,
    confidence: 50,          // 0..100
    // the ‚Äútruth‚Äù for the current example:
    isTarget: false,
    aiSaysTarget: false,
    ended: false
  };

  function updateHUD(){
    const hearts = "‚òÖ".repeat(Math.max(0, Math.ceil(state.confidence/20)));
    const pills = [
      `Round: ${state.round}/${state.maxRounds}`,
      `Turn: ${state.turn}/${state.maxTurns}`,
      `Mode: ${state.mode}`,
      `Confidence: ${state.confidence}%`,
      `Signal: ${hearts || "‚Äî"}`
    ];
    hudEl.innerHTML = "";
    pills.forEach(t => {
      const s = document.createElement("span");
      s.className = "pill";
      s.textContent = t;
      hudEl.appendChild(s);
    });
    confBar.style.width = state.confidence + "%";
    turnInfo.textContent = `Turn ${state.turn}/${state.maxTurns}`;
  }

  function buildGrid(activeIndices){
    gridEl.innerHTML = "";
    for(let i=0;i<9;i++){
      const cell = document.createElement("div");
      cell.className = "cell";
      if(activeIndices.includes(i)) cell.classList.add("on");
      gridEl.appendChild(cell);
    }
  }

  function pickTargetPattern(){
    return targets[Math.floor(Math.random() * targets.length)].slice();
  }

  function randomDistinct(count){
    const arr = [];
    while(arr.length < count){
      const n = Math.floor(Math.random()*9);
      if(!arr.includes(n)) arr.push(n);
    }
    return arr;
  }

  function addNoise(active, noiseMax){
    const noisy = active.slice();
    const addCount = Math.floor(Math.random() * (noiseMax + 1)); // 0..noiseMax
    for(let i=0;i<addCount;i++){
      const n = Math.floor(Math.random()*9);
      if(!noisy.includes(n)) noisy.push(n);
    }
    return noisy;
  }

  function aiClassify(){
    // ‚ÄúAI‚Äù decision: compare random roll vs confidence
    const roll = Math.random() * 100;
    state.aiSaysTarget = roll < state.confidence;
    aiGuessEl.textContent = state.aiSaysTarget ? "TARGET" : "NOT TARGET";
  }

  function newExample(){
    if(state.ended) return;

    const cfg = difficultyConfig(state.mode);

    // Decide if this example truly is target
    state.isTarget = Math.random() < 0.5;

    let active = state.isTarget ? pickTargetPattern() : randomDistinct(3);

    // Add noise in harder modes
    active = addNoise(active, cfg.noiseMax);

    // Build visuals
    buildGrid(active);

    // Ask AI
    aiClassify();

    // Store correctness for feedback logic
    // correct if AI says TARGET and isTarget, or AI says NOT TARGET and not target
    // we compute on feedback call
    updateHUD();
  }

  function endMatch(){
    state.ended = true;
    setButtonsEnabled(false);
    aiGuessEl.textContent = "TRAINING COMPLETE";
    toast("Training complete! Restart to play again.");
    log("=== TRAINING COMPLETE ===", "warn");
  }

  function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }

  function feedback(userSaysAiWasCorrect){
    // Error handling: ignore feedback if ended or no game started
    if(state.ended) { toast("Match is over. Press Restart."); return; }

    const cfg = difficultyConfig(state.mode);
    const actuallyCorrect = (state.aiSaysTarget === state.isTarget);

    if(userSaysAiWasCorrect === actuallyCorrect){
      // reinforce learning
      state.confidence = clamp(state.confidence + cfg.learnStep, 5, 95);
      log(`Reinforced ‚úÖ (AI was actually ${actuallyCorrect ? "correct" : "wrong"}). Confidence -> ${state.confidence}%`, "good");
      toast("Reinforced: AI improved.");
    } else {
      // correction/punishment
      state.confidence = clamp(state.confidence - cfg.penalty, 5, 95);
      log(`Corrected ‚ö†Ô∏è (AI was actually ${actuallyCorrect ? "correct" : "wrong"}). Confidence -> ${state.confidence}%`, "bad");
      toast("Corrected: AI adjusted.");
    }

    // advance turn/round
    state.turn += 1;
    if(state.turn > state.maxTurns){
      state.round += 1;
      state.turn = 1;
      log(`---- ROUND ${state.round}/${state.maxRounds} ----`, "warn");
      toast(`Round ${state.round} online`);
    }

    updateHUD();

    if(state.round > state.maxRounds){
      endMatch();
      return;
    }

    newExample();
  }

  function start(){
    state.mode = $("mode").value;
    state.round = 1;
    state.turn = 1;
    state.confidence = 50;
    state.ended = false;

    logEl.innerHTML = "";
    setButtonsEnabled(true);
    toast("System online. Training begins.");
    log(`Starting match ‚Ä¢ mode=${state.mode}`, "warn");
    log(`Goal: Train the AI over 5 rounds √ó 5 turns.`, "warn");

    updateHUD();
    newExample();
  }

  // ---------- Events ----------
  $("enterBtn").addEventListener("click", () => {
    $("intro").style.display = "none";
    toast("Welcome to NeuroGrid. Press Start.");
  });

  $("startBtn").addEventListener("click", start);

  $("mode").addEventListener("change", () => {
    state.mode = $("mode").value;
    toast("Mode changed. Restart to apply.");
    updateHUD();
  });

  $("correctBtn").addEventListener("click", () => feedback(true));
  $("wrongBtn").addEventListener("click", () => feedback(false));

  $("copyLogBtn").addEventListener("click", async () => {
    try{
      const text = Array.from(logEl.children).map(d => d.textContent).join("\n");
      await navigator.clipboard.writeText(text);
      toast("Log copied!");
      log("Log copied to clipboard.", "good");
    }catch(e){
      toast("Clipboard blocked ‚Äî copy manually.");
      log("Clipboard blocked by browser settings.", "warn");
    }
  });

  $("clearLogBtn").addEventListener("click", () => {
    logEl.innerHTML = "";
    toast("Log cleared.");
  });

  // Initial UI
  updateHUD();
  setButtonsEnabled(false);
  aiGuessEl.textContent = "‚Äî";
  log("Boot screen ready. Click BOOT SYSTEM.", "warn");
})();
</script>
</body>
</html>
